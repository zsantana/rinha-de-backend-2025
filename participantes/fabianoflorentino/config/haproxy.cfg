global
    maxconn 5500
    stats socket /var/lib/haproxy/stats level admin

defaults
    mode http
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms
    option httplog
    retries 3

# Stats frontend
frontend stats
    bind *:8404
    stats enable
    stats uri /stats
    stats refresh 5s

# Main frontend
frontend mr_robot_frontend
    bind *:9999
    default_backend mr_robot_backend

# Backend with load balancing
backend mr_robot_backend
    balance roundrobin
    option httpchk GET /health
    http-check expect status 200

    # Backend servers using Unix sockets - slower health checks
    server mr_robot1 /var/run/mr_robot/mr_robot1.sock check inter 60s fastinter 30s downinter 30s rise 2 fall 2
    server mr_robot2 /var/run/mr_robot/mr_robot2.sock check inter 60s fastinter 30s downinter 30s rise 2 fall 2
